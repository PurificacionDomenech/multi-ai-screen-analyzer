<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-IA Screen Analyzer</title>
  <link rel="icon" type="image/x-icon" href="ojo.ico">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="light">
  <div id="video-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: black; z-index: 9999; display: flex; justify-content: center; align-items: center;">
    <video id="intro-video" src="grok-video-8a01fda2-d9ef-4065-a2f7-104de5fe0d0c.mp4" autoplay muted playsinline style="max-width: 100%; max-height: 100%;"></video>
  </div>
  <div class="container">
    <header>
      <h1>ğŸ¤– Multi-IA Screen Analyzer</h1>
      <p class="subtitle">Captura tu pantalla y obtÃ©n anÃ¡lisis simultÃ¡neo de mÃºltiples IAs</p>
    </header>

    <div class="controls">
      <button onclick="toggleTheme()">ğŸŒ“ Cambiar Tema</button>
      <button onclick="exportResults()" class="secondary">ğŸ’¾ Exportar Resultados</button>
    </div>

    <div class="card">
      <div class="tab-container">
        <button class="tab active" onclick="switchTab('capture')">ğŸ“¸ Capturar</button>
        <button class="tab" onclick="switchTab('chat')">ğŸ’¬ Chat</button>
        <button class="tab" onclick="switchTab('config')">âš™ï¸ ConfiguraciÃ³n</button>
        <button class="tab" onclick="switchTab('help')">â“ Ayuda</button>
      </div>

      <!-- TAB: CAPTURA -->
      <div id="tab-capture" class="tab-content active">
        <h2>Selecciona las IAs a usar:</h2>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" id="use-claude" checked>
            <span>ğŸ§  Claude (Anthropic)</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="use-gemini" checked>
            <span>âœ¨ Gemini (Google)</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="use-grok">
            <span>ğŸš€ Grok (xAI)</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="use-local">
            <span>ğŸ–¥ï¸ Mi IA Local</span>
          </label>
          <div id="custom-ai-checkboxes"></div>
        </div>

        <div class="capture-section">
          <button class="capture-button" onclick="captureAndAnalyze()">
            ğŸ“¸ CAPTURAR PANTALLA AHORA
          </button>
        </div>

        <div id="preview" class="preview-container"></div>
        <div id="responses-container"></div>
      </div>

      <!-- TAB: CHAT -->
      <div id="tab-chat" class="tab-content">
        <h2>Selecciona las IAs para chatear:</h2>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" id="chat-claude" checked>
            <span>ğŸ§  Claude</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="chat-gemini" checked>
            <span>âœ¨ Gemini</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="chat-grok">
            <span>ğŸš€ Grok</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="chat-local">
            <span>ğŸ–¥ï¸ Mi IA Local</span>
          </label>
          <div id="chat-custom-ai-checkboxes"></div>
        </div>

        <div class="chat-container">
          <div id="chat-messages" class="chat-messages"></div>
          <div class="chat-input-container">
            <input type="file" id="chat-image" accept="image/*" style="display: none;" onchange="handleChatImageSelect(event)">
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
              <button onclick="captureToChatImage()" class="capture-to-chat" style="flex: 1;">
                ğŸ“¸ Capturar Pantalla
              </button>
              <button onclick="document.getElementById('chat-image').click()" class="secondary" style="flex: 1;">
                ğŸ“ Adjuntar Imagen
              </button>
            </div>
            <div id="chat-image-preview"></div>
            <textarea id="chat-input" placeholder="Escribe tu pregunta aquÃ­... (opcional con captura o imagen)" rows="3"></textarea>
            <button onclick="sendChatMessage()" class="success">ğŸ’¬ Enviar</button>
          </div>
        </div>
      </div>

      <!-- TAB: CONFIGURACIÃ“N -->
      <div id="tab-config" class="tab-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>Configurar IAs</h2>
          <button onclick="openAddAIModal()" class="add-new">â• AÃ±adir Nueva IA</button>
        </div>
        <p class="help-text" style="margin-bottom: 20px;">
          Las API keys se guardan localmente en tu navegador y nunca se envÃ­an a ningÃºn servidor externo.
        </p>

        <div class="ai-config">
          <!-- CLAUDE -->
          <div class="ai-item" id="claude-config">
            <div class="ai-header">
              <div class="ai-name">
                ğŸ§  Claude (Anthropic)
                <span class="status-badge disconnected" id="claude-status">No configurado</span>
              </div>
            </div>
            <form onsubmit="event.preventDefault(); saveKey('claude');">
              <div class="input-group">
                <label for="claude-key">API Key:</label>
                <input type="password" id="claude-key" placeholder="sk-ant-api03-..." autocomplete="off">
                <p class="help-text">ObtÃ©n tu key en: <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> (100k tokens/mes gratis)</p>
              </div>
              <div class="ai-actions">
                <button type="submit">ğŸ’¾ Guardar</button>
                <button type="button" onclick="testConnection('claude')" class="success">ğŸ” Probar ConexiÃ³n</button>
                <button type="button" onclick="clearKey('claude')" class="secondary">ğŸ—‘ï¸ Borrar</button>
              </div>
            </form>
          </div>

          <!-- GEMINI -->
          <div class="ai-item" id="gemini-config">
            <div class="ai-header">
              <div class="ai-name">
                âœ¨ Gemini (Google)
                <span class="status-badge disconnected" id="gemini-status">No configurado</span>
              </div>
            </div>
            <form onsubmit="event.preventDefault(); saveKey('gemini');">
              <div class="input-group">
                <label for="gemini-key">API Key:</label>
                <input type="password" id="gemini-key" placeholder="AIzaSy..." autocomplete="off">
                <p class="help-text">ObtÃ©n tu key en: <a href="https://aistudio.google.com/apikey" target="_blank">aistudio.google.com/apikey</a> (1.5M tokens/dÃ­a gratis)</p>
              </div>
              <div class="ai-actions">
                <button type="submit">ğŸ’¾ Guardar</button>
                <button type="button" onclick="testConnection('gemini')" class="success">ğŸ” Probar ConexiÃ³n</button>
                <button type="button" onclick="clearKey('gemini')" class="secondary">ğŸ—‘ï¸ Borrar</button>
              </div>
            </form>
          </div>

          <!-- GROK -->
          <div class="ai-item" id="grok-config">
            <div class="ai-header">
              <div class="ai-name">
                ğŸš€ Grok (xAI)
                <span class="status-badge disconnected" id="grok-status">No configurado</span>
              </div>
            </div>
            <form onsubmit="event.preventDefault(); saveKey('grok');">
              <div class="input-group">
                <label for="grok-key">API Key:</label>
                <input type="password" id="grok-key" placeholder="xai-..." autocomplete="off">
                <p class="help-text">ObtÃ©n tu key en: <a href="https://console.x.ai" target="_blank">console.x.ai</a></p>
              </div>
              <div class="ai-actions">
                <button type="submit">ğŸ’¾ Guardar</button>
                <button type="button" onclick="testConnection('grok')" class="success">ğŸ” Probar ConexiÃ³n</button>
                <button type="button" onclick="clearKey('grok')" class="secondary">ğŸ—‘ï¸ Borrar</button>
              </div>
            </form>
          </div>

          <!-- LOCAL (LM Studio / Ollama) -->
          <div class="ai-item" id="local-config">
            <div class="ai-header">
              <div class="ai-name">
                ğŸ–¥ï¸ Mi IA Local (LM Studio / Ollama)
                <span class="status-badge disconnected" id="local-status">No configurado</span>
              </div>
            </div>
            <div class="info-box" style="margin-bottom: 15px; background: rgba(255, 152, 0, 0.1); border-left-color: #ff9800;">
              <p style="margin: 0; font-size: 0.9rem;">
                âš ï¸ <strong>AsegÃºrate de tener LM Studio o Ollama corriendo localmente</strong> con el servidor API activado antes de usar esta opciÃ³n.
              </p>
            </div>
            <form onsubmit="event.preventDefault(); saveLocalConfig();">
              <div class="input-group">
                <label for="local-endpoint">Endpoint URL:</label>
                <input type="text" id="local-endpoint" placeholder="http://localhost:1234/v1/chat/completions" value="http://localhost:1234/v1/chat/completions" autocomplete="off">
                <p class="help-text">
                  LM Studio: <code>http://localhost:1234/v1/chat/completions</code><br>
                  Ollama: <code>http://localhost:11434/v1/chat/completions</code>
                </p>
              </div>
              <div class="input-group">
                <label for="local-model">Nombre del Modelo:</label>
                <input type="text" id="local-model" placeholder="local-model" value="local-model" autocomplete="off">
                <p class="help-text">Puedes usar cualquier nombre, el servidor local lo gestionarÃ¡</p>
              </div>
              <div class="ai-actions">
                <button type="submit">ğŸ’¾ Guardar</button>
                <button type="button" onclick="testConnection('local')" class="success">ğŸ” Probar ConexiÃ³n</button>
                <button type="button" onclick="clearLocalConfig()" class="secondary">ğŸ—‘ï¸ Borrar</button>
              </div>
            </form>
          </div>

          <!-- IAs PERSONALIZADAS -->
          <div id="custom-ai-configs"></div>
        </div>
      </div>

      <!-- TAB: AYUDA -->
      <div id="tab-help" class="tab-content">
        <h2>ğŸ“– CÃ³mo usar esta herramienta</h2>

        <div class="info-box">
          <h3>ğŸš€ Inicio RÃ¡pido:</h3>
          <ol style="margin-left: 20px; line-height: 1.8;">
            <li>Ve a la pestaÃ±a <strong>"ConfiguraciÃ³n"</strong></li>
            <li>Ingresa tus API keys (Claude, Gemini, Grok)</li>
            <li><strong>NUEVO:</strong> AÃ±ade IAs personalizadas con el botÃ³n "â• AÃ±adir Nueva IA"</li>
            <li>Haz clic en "Guardar" y "Probar ConexiÃ³n" en cada IA</li>
            <li>Vuelve a "Capturar", selecciona las IAs que quieres usar</li>
            <li>Haz clic en "CAPTURAR PANTALLA AHORA"</li>
            <li>Selecciona la ventana/pantalla que quieres compartir</li>
            <li>Â¡Espera las respuestas de las IAs!</li>
          </ol>
        </div>

        <div class="info-box">
          <h3>âœ¨ Sistema Modular (NUEVO):</h3>
          <ul>
            <li><strong>IAs Predefinidas:</strong> Claude, Gemini, Grok vienen preconfiguradas</li>
            <li><strong>AÃ±ade Nuevas IAs:</strong> Soporta cualquier API compatible con visiÃ³n</li>
            <li><strong>Ejemplos compatibles:</strong> OpenAI GPT-4V, Anthropic Haiku, Mistral Pixtral, Llama Vision, etc.</li>
            <li><strong>Tipos soportados:</strong> OpenAI-compatible, Anthropic, Google, Custom JSON</li>
            <li><strong>GestiÃ³n flexible:</strong> Elimina IAs personalizadas que no uses</li>
          </ul>
        </div>

        <div class="info-box">
          <h3>ğŸ’¡ Casos de Uso:</h3>
          <ul>
            <li><strong>Debugging:</strong> Comparte tu cÃ³digo con error y obtÃ©n mÃºltiples perspectivas</li>
            <li><strong>Code Review:</strong> Las IAs detectan bugs, sugieren mejoras y optimizaciones</li>
            <li><strong>Aprendizaje:</strong> Comparte tutoriales o documentaciÃ³n y obtÃ©n explicaciones</li>
            <li><strong>AnÃ¡lisis de UI:</strong> Muestra tu diseÃ±o y recibe feedback de UX</li>
            <li><strong>ComparaciÃ³n:</strong> Ve cÃ³mo diferentes IAs abordan el mismo problema</li>
          </ul>
        </div>

        <div class="info-box">
          <h3>ğŸ”’ Privacidad y Seguridad:</h3>
          <ul>
            <li>Las API keys se guardan <strong>solo en tu navegador</strong> (LocalStorage)</li>
            <li>Las capturas se envÃ­an <strong>directamente</strong> a las APIs oficiales</li>
            <li>Esta aplicaciÃ³n <strong>NO tiene servidor backend</strong> - todo es client-side</li>
            <li>CÃ³digo 100% open source auditable en GitHub</li>
            <li>Nunca compartas tus API keys con nadie</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: AÃ‘ADIR NUEVA IA -->
  <div id="add-ai-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>â• AÃ±adir Nueva IA</h2>
        <button class="close-modal" onclick="closeAddAIModal()">âœ•</button>
      </div>

      <div class="input-group">
        <label>Nombre de la IA:</label>
        <input type="text" id="new-ai-name" placeholder="ej: GPT-4 Vision, Claude Haiku, Llama Vision...">
      </div>

      <div class="input-group">
        <label>Icono (emoji):</label>
        <input type="text" id="new-ai-icon" placeholder="ej: ğŸ”®, ğŸ¦™, ğŸŒŸ" maxlength="2">
      </div>

      <div class="input-group">
        <label>Tipo de API:</label>
        <select id="new-ai-type">
          <option value="openai">OpenAI Compatible (GPT-4V, Llama, Mistral, etc.)</option>
          <option value="anthropic">Anthropic Compatible (Claude Haiku, Opus, etc.)</option>
          <option value="google">Google Compatible (Gemini Pro, Flash, etc.)</option>
        </select>
        <p class="help-text">Selecciona el formato de API que usa tu IA personalizada</p>
      </div>

      <div class="input-group">
        <label>API Endpoint URL:</label>
        <input type="text" id="new-ai-endpoint" placeholder="https://api.openai.com/v1/chat/completions">
        <p class="help-text">URL completa del endpoint de la API</p>
      </div>

      <div class="input-group">
        <label>Modelo:</label>
        <input type="text" id="new-ai-model" placeholder="ej: gpt-4-vision-preview, claude-3-haiku...">
      </div>

      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button onclick="addCustomAI()" class="add-new" style="flex: 1;">âœ… AÃ±adir IA</button>
        <button onclick="closeAddAIModal()" class="secondary" style="flex: 1;">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>